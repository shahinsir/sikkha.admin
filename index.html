<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="শিক্ষা এডমিন">
    <meta name="description" content="শিক্ষা সহায়িকা কন্টেন্ট ম্যানেজমেন্ট সিস্টেম - পূর্ণাঙ্গ এডমিন অ্যাপ">
    <meta name="keywords" content="শিক্ষা, কন্টেন্ট, এডমিন, বাংলাদেশ, বই, গাইড, PWA">
    <title>শিক্ষা সহায়িকা এডমিন</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="https://i.ibb.co/XGNQ8V4/icon-180x180.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/wFnz89n6/icon-192x192.png">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts for Bengali -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #3498db;
            --primary-light: #5dade2;
            --primary-dark: #1a5276;
            --secondary-color: #2c3e50;
            --secondary-light: #34495e;
            --success-color: #27ae60;
            --success-light: #52be80;
            --danger-color: #e74c3c;
            --danger-light: #ec7063;
            --warning-color: #f39c12;
            --warning-light: #f7dc6f;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --light-bg: #f8f9fa;
            --border-color: #e0e0e0;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --radius: 12px;
            --radius-lg: 20px;
            --radius-xl: 30px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Hind Siliguri', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* Loading Animation */
        .loading-wave {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            height: 100px;
        }
        
        .loading-bar {
            width: 10px;
            height: 30px;
            background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
            border-radius: 5px;
            animation: loading-wave-animation 1s ease-in-out infinite;
        }
        
        .loading-bar:nth-child(2) {
            animation-delay: 0.1s;
        }
        
        .loading-bar:nth-child(3) {
            animation-delay: 0.2s;
        }
        
        .loading-bar:nth-child(4) {
            animation-delay: 0.3s;
        }
        
        @keyframes loading-wave-animation {
            0%, 100% {
                height: 30px;
            }
            50% {
                height: 60px;
            }
        }
        
        /* Pulse Animation */
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(52, 152, 219, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
            }
        }
        
        /* Floating Animation */
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        /* Slide In Animation */
        @keyframes slideInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Slide In Right Animation */
        @keyframes slideInRight {
            from {
                transform: translateX(30px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Fade In Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        /* Login Modal - Improved */
        #loginModal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .login-container {
            background: white;
            padding: 50px 40px;
            border-radius: var(--radius-xl);
            max-width: 480px;
            width: 100%;
            text-align: center;
            box-shadow: var(--shadow-hover);
            animation: slideInUp 0.6s ease;
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color), var(--warning-color));
            background-size: 300% 100%;
            animation: gradient-shift 3s ease infinite;
        }
        
        @keyframes gradient-shift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .login-container h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: 700;
            position: relative;
            padding-bottom: 15px;
        }
        
        .login-container h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: var(--primary-color);
            border-radius: 2px;
        }
        
        .login-container > p {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .login-form-group {
            margin-bottom: 24px;
            text-align: left;
        }
        
        .login-form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--secondary-color);
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .login-form-group input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 16px;
            font-family: 'Hind Siliguri', sans-serif;
            transition: var(--transition);
            background: var(--light-bg);
        }
        
        .login-form-group input:focus {
            border-color: var(--primary-color);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        #loginError {
            background: linear-gradient(135deg, #ffcccc, #ff9999);
            color: #c0392b;
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 25px;
            display: none;
            border-left: 5px solid #e74c3c;
            animation: slideInRight 0.3s ease;
        }
        
        .login-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 17px;
            font-weight: 700;
            font-family: 'Hind Siliguri', sans-serif;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .login-btn:hover::before {
            left: 100%;
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
        }
        
        .login-btn:active {
            transform: translateY(-1px);
        }
        
        .login-footer {
            margin-top: 30px;
            color: #777;
            font-size: 15px;
            line-height: 1.6;
            border-top: 1px solid var(--border-color);
            padding-top: 25px;
        }
        
        /* Main App Container - Improved */
        .admin-container {
            max-width: 1300px;
            margin: 30px auto;
            background: white;
            color: #333;
            padding: 35px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-hover);
            display: none;
            animation: fadeIn 0.8s ease;
            position: relative;
            overflow: hidden;
            min-height: 90vh;
        }
        
        .admin-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(52, 152, 219, 0.1) 0%, rgba(52, 152, 219, 0) 70%);
            z-index: 0;
        }
        
        .admin-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(39, 174, 96, 0.1) 0%, rgba(39, 174, 96, 0) 70%);
            z-index: 0;
        }
        
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .header-left h1 {
            color: var(--secondary-color);
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
        }
        
        .header-left h1 img {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .user-info {
            background: linear-gradient(135deg, var(--light-bg), white);
            padding: 12px 20px;
            border-radius: var(--radius);
            color: var(--secondary-color);
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .user-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .user-info i {
            color: var(--primary-color);
            font-size: 18px;
        }
        
        .logout-btn {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 15px;
            font-family: 'Hind Siliguri', sans-serif;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }
        
        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--success-color), #219653);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.2);
            animation: pulse 3s infinite;
            transition: var(--transition);
        }
        
        .connection-status:hover {
            transform: translateY(-2px);
        }
        
        .status-offline {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            animation: none;
        }
        
        /* PWA Status Bar */
        .pwa-status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-dark));
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            text-align: center;
            z-index: 9998;
            display: none;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            animation: slideInUp 0.5s ease;
        }
        
        .app-installed-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success-color), var(--success-light));
            color: white;
            padding: 10px 18px;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 600;
            z-index: 9997;
            display: none;
            animation: slideInRight 0.5s ease;
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Form Section - Improved */
        .form-section {
            background: white;
            padding: 30px;
            border-radius: var(--radius-lg);
            margin-bottom: 35px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            z-index: 1;
        }
        
        .form-section:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-5px);
        }
        
        .form-section h3 {
            color: var(--secondary-color);
            margin-bottom: 25px;
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.1);
        }
        
        .form-section h4 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1024px) {
            .two-column {
                grid-template-columns: 1fr;
                gap: 25px;
            }
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: 25px;
                margin: 15px;
            }
            
            .app-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .header-right {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        /* Buttons - Improved */
        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            padding: 16px 28px;
            cursor: pointer;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 700;
            font-family: 'Hind Siliguri', sans-serif;
            transition: var(--transition);
            width: 100%;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            opacity: 0;
            z-index: -1;
            transition: var(--transition);
        }
        
        .btn:hover::before {
            opacity: 1;
        }
        
        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(52, 152, 219, 0.3);
        }
        
        .btn:active {
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color), var(--success-light));
        }
        
        .btn-success::before {
            background: linear-gradient(135deg, var(--success-light), var(--success-color));
        }
        
        .btn-success:hover {
            box-shadow: 0 12px 25px rgba(39, 174, 96, 0.3);
        }
        
        .btn-install {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            margin-top: 20px;
        }
        
        .btn-install::before {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
        }
        
        .btn-install:hover {
            box-shadow: 0 12px 25px rgba(155, 89, 182, 0.3);
        }
        
        /* Tables - Improved */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            margin-top: 25px;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        th {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 18px 20px;
            text-align: left;
            font-weight: 700;
            font-size: 16px;
        }
        
        th:first-child {
            border-top-left-radius: var(--radius);
        }
        
        th:last-child {
            border-top-right-radius: var(--radius);
        }
        
        td {
            padding: 18px 20px;
            border-bottom: 1px solid rgba(224, 224, 224, 0.5);
            transition: var(--transition);
        }
        
        tr:hover td {
            background-color: rgba(52, 152, 219, 0.05);
            transform: scale(1.01);
        }
        
        /* Material Type Badges - Improved */
        .material-type {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        
        .material-type:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        .material-type.book { 
            background: linear-gradient(135deg, #e3f2fd, #bbdefb); 
            color: #0d47a1; 
            border-left: 4px solid #1976d2;
        }
        
        .material-type.guide { 
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9); 
            color: #1b5e20; 
            border-left: 4px solid #388e3c;
        }
        
        .material-type.note { 
            background: linear-gradient(135deg, #fff3e0, #ffe0b2); 
            color: #e65100; 
            border-left: 4px solid #f57c00;
        }
        
        .material-type.video { 
            background: linear-gradient(135deg, #f3e5f5, #e1bee7); 
            color: #4a148c; 
            border-left: 4px solid #7b1fa2;
        }
        
        .material-type.image { 
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2); 
            color: #006064; 
            border-left: 4px solid #0097a7;
        }
        
        .material-type.pdf { 
            background: linear-gradient(135deg, #ffebee, #ffcdd2); 
            color: #b71c1c; 
            border-left: 4px solid #d32f2f;
        }
        
        .material-type.question { 
            background: linear-gradient(135deg, #fce4ec, #f8bbd9); 
            color: #880e4f; 
            border-left: 4px solid #c2185b;
        }
        
        /* Action Buttons - Improved */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .view-btn, .edit-btn, .delete-btn, .download-btn {
            padding: 10px 18px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Hind Siliguri', sans-serif;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 45px;
            justify-content: center;
        }
        
        .view-btn { 
            background: linear-gradient(135deg, var(--success-color), var(--success-light)); 
            color: white; 
        }
        
        .edit-btn { 
            background: linear-gradient(135deg, var(--warning-color), var(--warning-light)); 
            color: white; 
        }
        
        .delete-btn { 
            background: linear-gradient(135deg, var(--danger-color), var(--danger-light)); 
            color: white; 
        }
        
        .download-btn { 
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light)); 
            color: white; 
        }
        
        .view-btn:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }
        
        .edit-btn:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.3);
        }
        
        .delete-btn:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }
        
        .download-btn:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }
        
        /* PWA Install Prompt - Improved */
        #installPrompt {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 30px;
            border-radius: var(--radius-lg);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            max-width: 380px;
            animation: slideInRight 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid var(--primary-color);
            overflow: hidden;
        }
        
        #installPrompt::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color), var(--warning-color));
            background-size: 300% 100%;
            animation: gradient-shift 3s ease infinite;
        }
        
        #installPrompt h4 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
        }
        
        #installPrompt p {
            color: #555;
            margin-bottom: 20px;
            line-height: 1.7;
        }
        
        .prompt-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .prompt-buttons button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 700;
            font-family: 'Hind Siliguri', sans-serif;
            transition: var(--transition);
            font-size: 16px;
        }
        
        .install-btn {
            background: linear-gradient(135deg, var(--success-color), var(--success-light));
            color: white;
        }
        
        .install-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }
        
        .later-btn {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .later-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(149, 165, 166, 0.3);
        }
        
        /* iOS/Android Install Modals - Improved */
        #iosInstallModal, #androidInstallModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.4s ease;
        }
        
        .ios-modal-content, .android-modal-content {
            background: white;
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 550px;
            width: 100%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .ios-modal-content::before, .android-modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
        }
        
        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .ios-modal-content h3, .android-modal-content h3 {
            color: var(--secondary-color);
            margin-bottom: 25px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
        }
        
        .ios-steps {
            margin: 25px 0;
            padding-left: 25px;
        }
        
        .ios-steps li {
            margin-bottom: 15px;
            color: #555;
            line-height: 1.7;
            padding-left: 10px;
            position: relative;
        }
        
        .ios-steps li::before {
            content: '✓';
            position: absolute;
            left: -25px;
            color: var(--success-color);
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Custom Install Button Styles - Improved */
        .install-button-container {
            text-align: center;
            margin: 35px 0;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            border-radius: var(--radius-lg);
            border: 3px dashed var(--primary-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .install-button-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: var(--success-color);
        }
        
        .install-button-container h3 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 700;
        }
        
        .install-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .install-feature {
            background: white;
            padding: 18px;
            border-radius: var(--radius);
            font-size: 15px;
            text-align: center;
            border: 2px solid rgba(52, 152, 219, 0.1);
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .install-feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .install-feature span {
            display: block;
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        /* Touch Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn, .view-btn, .edit-btn, .delete-btn, .logout-btn {
                min-height: 50px;
                min-width: 50px;
            }
            
            input, select, textarea, button {
                font-size: 16px !important;
            }
            
            .action-buttons {
                gap: 12px;
            }
            
            .action-buttons button {
                padding: 14px 22px;
                min-width: 65px;
            }
            
            .form-section {
                padding: 25px;
            }
        }
        
        /* Status Messages - Improved */
        .status-message {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 18px 28px;
            border-radius: var(--radius);
            color: white;
            z-index: 9996;
            display: none;
            animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            font-weight: 600;
            backdrop-filter: blur(10px);
            max-width: 400px;
            border-left: 5px solid white;
        }
        
        .status-success {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.95), rgba(46, 204, 113, 0.95));
            border-left-color: #27ae60;
        }
        
        .status-error {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.95), rgba(231, 76, 60, 0.95));
            border-left-color: #c0392b;
        }
        
        .status-warning {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.95), rgba(241, 196, 15, 0.95));
            border-left-color: #d68910;
        }
        
        .status-info {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.95), rgba(41, 128, 185, 0.95));
            border-left-color: #2980b9;
        }
        
        /* Form Elements - Improved */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--secondary-color);
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group select, .form-group input, .form-group textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 16px;
            font-family: 'Hind Siliguri', sans-serif;
            transition: var(--transition);
            background: var(--light-bg);
        }
        
        .form-group select:focus, .form-group input:focus, .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        /* File Upload Styles - Improved */
        .file-upload-container {
            background: linear-gradient(135deg, #f8f9fa, white);
            border: 3px dashed var(--primary-color);
            border-radius: var(--radius-lg);
            padding: 40px 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .file-upload-container:hover {
            background: linear-gradient(135deg, #e8f4fc, #f5fbff);
            border-color: var(--primary-dark);
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(52, 152, 219, 0.15);
        }
        
        .file-upload-container.dragover {
            background: linear-gradient(135deg, #d6eaf8, #ebf5fb);
            border-color: var(--success-color);
            transform: scale(1.02);
        }
        
        .file-upload-container .upload-icon {
            font-size: 64px;
            color: var(--primary-color);
            margin-bottom: 20px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }
        
        .file-preview {
            max-width: 220px;
            max-height: 220px;
            margin: 15px auto;
            display: block;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transition: var(--transition);
        }
        
        .file-preview:hover {
            transform: scale(1.05);
        }
        
        .file-info {
            background: linear-gradient(135deg, #e8f4fd, white);
            padding: 18px;
            border-radius: var(--radius);
            margin-top: 15px;
            font-size: 15px;
            color: var(--secondary-color);
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .file-size {
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .upload-progress {
            width: 100%;
            height: 12px;
            background: #ecf0f1;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71, #1abc9c);
            width: 0%;
            transition: width 0.3s;
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: progress-shine 1.5s infinite;
        }
        
        @keyframes progress-shine {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        /* File Management Tabs - Improved */
        .tabs {
            display: flex;
            border-bottom: 2px solid rgba(224, 224, 224, 0.5);
            margin-bottom: 30px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 16px 28px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 700;
            color: #95a5a6;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab:hover:not(.active) {
            color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.6s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* File Type Badges - Improved */
        .file-type-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-right: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .file-type-pdf { 
            background: linear-gradient(135deg, #ffebee, #ffcdd2); 
            color: #d32f2f; 
        }
        
        .file-type-image { 
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9); 
            color: #388e3c; 
        }
        
        .file-type-video { 
            background: linear-gradient(135deg, #f3e5f5, #e1bee7); 
            color: #7b1fa2; 
        }
        
        .file-type-doc { 
            background: linear-gradient(135deg, #e3f2fd, #bbdefb); 
            color: #1976d2; 
        }
        
        .file-type-zip { 
            background: linear-gradient(135deg, #fff3e0, #ffe0b2); 
            color: #f57c00; 
        }
        
        .file-type-other { 
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0); 
            color: #616161; 
        }
        
        /* Modal Styles - Improved */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 10002;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.4s ease;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.4);
            position: relative;
        }
        
        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(224, 224, 224, 0.5);
        }
        
        .modal-header h3 {
            color: var(--secondary-color);
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .close-modal {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }
        
        .file-viewer {
            max-width: 100%;
            max-height: 450px;
            margin: 0 auto;
            display: block;
            border-radius: var(--radius);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        
        .file-viewer.pdf {
            width: 100%;
            height: 450px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
        }
        
        /* Stats Grid - Improved */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, white, #f8f9fa);
            padding: 25px 20px;
            border-radius: var(--radius);
            text-align: center;
            border: 2px solid rgba(52, 152, 219, 0.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-box:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: rgba(52, 152, 219, 0.3);
        }
        
        .stat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 8px;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        /* Instruction Box - Improved */
        .instruction-box {
            background: linear-gradient(135deg, #e8f4fd, white);
            padding: 25px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            border-left: 6px solid var(--primary-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }
        
        .instruction-box h4 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
        }
        
        .instruction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .instruction-item {
            background: white;
            padding: 18px;
            border-radius: var(--radius);
            font-size: 15px;
            color: #555;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(52, 152, 219, 0.1);
            transition: var(--transition);
        }
        
        .instruction-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            border-color: rgba(52, 152, 219, 0.3);
        }
        
        .instruction-item .number {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        /* Link Guide Section - Improved */
        .link-box {
            background: linear-gradient(135deg, #e8f4fd, white);
            padding: 25px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .link-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .link-box strong {
            color: var(--secondary-color);
            font-size: 18px;
            margin-bottom: 15px;
            display: block;
        }
        
        .link-guide-steps {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 15px;
            border: 1px solid rgba(52, 152, 219, 0.2);
        }
        
        /* Filter Section - Improved */
        .filter-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
            background: linear-gradient(135deg, #f8f9fa, white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        
        .filter-section select, .filter-section input {
            padding: 14px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 15px;
            font-family: 'Hind Siliguri', sans-serif;
            transition: var(--transition);
            background: white;
            min-width: 150px;
        }
        
        .filter-section select:focus, .filter-section input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 30px;
            color: #95a5a6;
        }
        
        .empty-state i {
            font-size: 70px;
            margin-bottom: 25px;
            color: #bdc3c7;
            display: block;
        }
        
        .empty-state h4 {
            font-size: 22px;
            margin-bottom: 15px;
            color: #7f8c8d;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 576px) {
            .login-container {
                padding: 35px 25px;
            }
            
            .admin-container {
                padding: 20px;
                margin: 10px;
            }
            
            .modal-content {
                padding: 30px 25px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .install-features {
                grid-template-columns: 1fr;
            }
            
            .instruction-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-section select, .filter-section input {
                width: 100%;
            }
            
            .prompt-buttons {
                flex-direction: column;
            }
            
            #installPrompt {
                bottom: 20px;
                right: 20px;
                left: 20px;
                max-width: none;
            }
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2c3e50, #4a235a);
            }
            
            .admin-container, .login-container, .modal-content, 
            .ios-modal-content, .android-modal-content, 
            .form-section, .instruction-box, .link-box,
            .file-upload-container, .file-info, .stat-box,
            .instruction-item, .link-guide-steps {
                background: #2c3e50;
                color: #ecf0f1;
                border-color: #34495e;
            }
            
            .form-section h3, .form-section h4, .header-left h1,
            .login-container h2, .modal-header h3, .link-box strong,
            .instruction-box h4, .stat-label, .form-group label,
            .login-form-group label, .tab, .empty-state h4 {
                color: #ecf0f1;
            }
            
            .form-group select, .form-group input, .form-group textarea,
            .login-form-group input, .filter-section select, .filter-section input {
                background: #34495e;
                color: #ecf0f1;
                border-color: #4a6278;
            }
            
            .form-group select:focus, .form-group input:focus, .form-group textarea:focus,
            .login-form-group input:focus {
                background: #3c546b;
                border-color: var(--primary-color);
            }
            
            table, th, td {
                background: #2c3e50;
                color: #ecf0f1;
                border-color: #34495e;
            }
            
            tr:hover td {
                background-color: rgba(52, 152, 219, 0.2);
            }
            
            .install-button-container, .user-info {
                background: linear-gradient(135deg, #34495e, #2c3e50);
                color: #ecf0f1;
            }
        }
        
        /* Performance Optimizations */
        .will-change {
            will-change: transform, opacity;
        }
        
        /* Print Styles */
        @media print {
            #loginModal, #installPrompt, #iosInstallModal, 
            #androidInstallModal, .app-installed-badge, 
            .pwa-status-bar, .status-message, .action-buttons {
                display: none !important;
            }
            
            .admin-container {
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal">
        <div class="login-container">
            <h2><i class="fas fa-user-shield"></i> শিক্ষা সহায়িকা এডমিন</h2>
            <p>শুধুমাত্র অনুমোদিত অ্যাডমিনদের জন্য প্রবেশ</p>
            
            <div id="loginError"></div>
            
            <div class="login-form-group">
                <label for="adminEmail"><i class="fas fa-envelope"></i> ইমেইল এড্রেস</label>
                <input type="email" id="adminEmail" placeholder="admin@example.com" autocomplete="email">
            </div>
            
            <div class="login-form-group">
                <label for="adminPassword"><i class="fas fa-lock"></i> পাসওয়ার্ড</label>
                <input type="password" id="adminPassword" placeholder="••••••••" autocomplete="current-password">
            </div>
            
            <button onclick="loginAdmin()" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> লগইন করুন
            </button>
            
            <div class="install-button-container">
                <h3><i class="fas fa-mobile-alt"></i> অ্যাপ ইনস্টল করুন</h3>
                <div class="install-features">
                    <div class="install-feature"><span><i class="fas fa-upload"></i></span> ফাইল আপলোড</div>
                    <div class="install-feature"><span><i class="fas fa-bolt"></i></span> দ্রুত এক্সেস</div>
                    <div class="install-feature"><span><i class="fas fa-folder"></i></span> ফাইল ম্যানেজ</div>
                    <div class="install-feature"><span><i class="fas fa-bell"></i></span> নোটিফিকেশন</div>
                </div>
                <button id="installButtonMain" class="btn btn-install" style="max-width: 300px; margin: 0 auto;">
                    <span style="font-size: 32px; display: block; margin-bottom: 10px;"><i class="fas fa-download"></i></span>
                    <strong>অ্যাপ ইনস্টল করুন</strong>
                    <br>
                    <small style="font-size: 13px; opacity: 0.9;">হোম স্ক্রিনে যুক্ত করুন</small>
                </button>
            </div>
            
            <div class="login-footer">
                <p><i class="fas fa-info-circle"></i> এই অ্যাপটি PWA হিসেবে ইনস্টল করে ব্যবহার করুন</p>
                <p style="font-size: 14px; color: #888; margin-top: 15px;">ইনস্টলের জন্য উপরের ইনস্টল বাটনে ক্লিক করুন</p>
            </div>
        </div>
    </div>
    
    <!-- PWA Status Bar -->
    <div id="pwaStatus" class="pwa-status-bar"></div>
    
    <!-- App Installed Badge -->
    <div class="app-installed-badge">
        <i class="fas fa-check-circle"></i> <span>ইনস্টল করা</span>
    </div>
    
    <!-- Status Messages -->
    <div id="statusMessage" class="status-message"></div>
    
    <!-- File View Modal -->
    <div id="fileViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file"></i> <span id="fileViewTitle">ফাইল দেখুন</span></h3>
                <button onclick="closeFileViewer()" class="close-modal">×</button>
            </div>
            <div id="fileViewContent">
                <!-- File content will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- File Edit Modal -->
    <div id="fileEditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ফাইল এডিট করুন</h3>
                <button onclick="closeFileEditor()" class="close-modal">×</button>
            </div>
            <div id="fileEditContent">
                <!-- File edit form will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="admin-container" id="adminContainer">
        <div class="app-header">
            <div class="header-left">
                <h1><img src="https://i.ibb.co/wFnz89n6/icon-192x192.png" alt="আইকন"> শিক্ষা সহায়িকা এডমিন</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="userEmail">admin@example.com</span>
                </div>
                <button onclick="logoutAdmin()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> লগআউট
                </button>
            </div>
        </div>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <span id="connectionStatus" class="connection-status will-change">
                <i class="fas fa-wifi" id="statusIcon"></i>
                <span id="statusText">অনলাইন</span>
            </span>
        </div>
        
        <!-- File Management Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('contentTab')">
                <i class="fas fa-edit"></i> কন্টেন্ট ম্যানেজমেন্ট
            </button>
            <button class="tab" onclick="switchTab('fileTab')">
                <i class="fas fa-folder"></i> ফাইল ম্যানেজমেন্ট
            </button>
            <button class="tab" onclick="switchTab('uploadTab')">
                <i class="fas fa-upload"></i> ফাইল আপলোড
            </button>
        </div>
        
        <!-- Content Tab -->
        <div id="contentTab" class="tab-content active">
            <div class="instruction-box">
                <h4><i class="fas fa-info-circle"></i> গুরুত্বপূর্ণ নির্দেশনা:</h4>
                <div class="instruction-grid">
                    <div class="instruction-item">
                        <div class="number">1</div>
                        <div>ক্লাস সিলেক্ট করুন (৬-১০)</div>
                    </div>
                    <div class="instruction-item">
                        <div class="number">2</div>
                        <div>বিষয় সিলেক্ট করুন</div>
                    </div>
                    <div class="instruction-item">
                        <div class="number">3</div>
                        <div>কন্টেন্ট টাইপ এবং টাইটেল দিন</div>
                    </div>
                    <div class="instruction-item">
                        <div class="number">4</div>
                        <div>গুগল ড্রাইভ লিঙ্ক যোগ করুন</div>
                    </div>
                    <div class="instruction-item">
                        <div class="number">5</div>
                        <div>ইউজার অ্যাপে স্বয়ংক্রিয়ভাবে দেখাবে</div>
                    </div>
                    <div class="instruction-item">
                        <div class="number">6</div>
                        <div><i class="fas fa-mobile-alt"></i> অ্যাপটি ইনস্টল করুন</div>
                    </div>
                </div>
            </div>
            
            <div class="two-column">
                <!-- Form Section -->
                <div class="form-section">
                    <h3><i class="fas fa-plus-circle"></i> নতুন কন্টেন্ট যুক্ত করুন</h3>
                    
                    <div class="form-group">
                        <label><i class="fas fa-graduation-cap"></i> ক্লাস নির্বাচন করুন:</label>
                        <select id="classSelect">
                            <option value="">-- ক্লাস সিলেক্ট করুন --</option>
                            <option value="Class 6">Class 6 - ষষ্ঠ শ্রেণী</option>
                            <option value="Class 7">Class 7 - সপ্তম শ্রেণী</option>
                            <option value="Class 8">Class 8 - অষ্টম শ্রেণী</option>
                            <option value="Class 9">Class 9 - নবম শ্রেণী</option>
                            <option value="Class 10">Class 10 - দশম শ্রেণী</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-book"></i> বিষয় নির্বাচন করুন:</label>
                        <select id="subjectSelect">
                            <option value="">-- বিষয় সিলেক্ট করুন --</option>
                            <option value="math">গণিত (Mathematics)</option>
                            <option value="english">ইংরেজি (English)</option>
                            <option value="science">বিজ্ঞান (Science)</option>
                            <option value="ict">তথ্য ও যোগাযোগ প্রযুক্তি (ICT)</option>
                            <option value="agriculture">কৃষি শিক্ষা (Agriculture)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-file-alt"></i> কন্টেন্ট টাইপ:</label>
                        <select id="typeSelect">
                            <option value="বই">বই (Book)</option>
                            <option value="গাইড">গাইড (Guide)</option>
                            <option value="নোট">নোট (Note)</option>
                            <option value="ভিডিও">ভিডিও (Video)</option>
                            <option value="প্রশ্ন">প্রশ্ন (Question)</option>
                            <option value="পিডিএফ">পিডিএফ (PDF)</option>
                            <option value="ছবি">ছবি (Image)</option>
                            <option value="MCQ">MCQ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-heading"></i> শিরোনাম (Title):</label>
                        <input type="text" id="title" placeholder="যেমন: গণিত বই, ইংরেজি গ্রামার, বিজ্ঞান নোট">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> বর্ণনা (Description):</label>
                        <textarea id="description" rows="3" placeholder="বিস্তারিত বর্ণনা লিখুন..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-link"></i> লিঙ্ক (Link):</label>
                        <input type="text" id="link" placeholder="https://drive.google.com/file/d/XXXXX/view">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Google Drive, YouTube, PDF বা অন্য যেকোনো ফাইল লিঙ্ক দিন
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-external-link-alt"></i> লিঙ্ক টাইপ:</label>
                        <select id="linkType">
                            <option value="drive">Google Drive</option>
                            <option value="youtube">YouTube</option>
                            <option value="pdf">PDF লিঙ্ক</option>
                            <option value="image">ছবি লিঙ্ক</option>
                            <option value="website">ওয়েবসাইট</option>
                            <option value="other">অন্যান্য</option>
                        </select>
                    </div>
                    
                    <button onclick="addData()" class="btn btn-success" id="submitBtn">
                        <i class="fas fa-save"></i> ডেটা সেভ করুন
                    </button>
                </div>
                
                <!-- Link Guide Section -->
                <div class="form-section">
                    <h3><i class="fas fa-link"></i> লিঙ্ক গাইড</h3>
                    
                    <div class="link-box">
                        <strong><i class="fas fa-google-drive"></i> গুগল ড্রাইভ লিঙ্ক তৈরি:</strong>
                        <div class="link-guide-steps">
                            1. ফাইল গুগল ড্রাইভে আপলোড করুন<br>
                            2. ফাইলে রাইট-ক্লিক → "Get link"<br>
                            3. "Anyone with the link" সিলেক্ট করুন<br>
                            4. লিঙ্ক কপি করুন এবং এখানে পেস্ট করুন
                        </div>
                    </div>
                    
                    <div class="link-box" style="border-left-color: #27ae60;">
                        <strong><i class="fas fa-lightbulb"></i> টিপস:</strong>
                        <div class="link-guide-steps">
                            • YouTube ভিডিওর জন্য শুধুমাত্র ভিডিও ID দিন<br>
                            • PDF লিঙ্ক সঠিক কিনা নিশ্চিত করুন<br>
                            • লিঙ্ক টেস্ট করে দেখুন<br>
                            • সঠিক টাইপ সিলেক্ট করুন
                        </div>
                    </div>
                </div>
            </div>

            <!-- Display Section -->
            <div class="form-section">
                <h3><i class="fas fa-list"></i> বর্তমান কন্টেন্টসমূহ</h3>
                
                <div class="filter-section">
                    <div style="color: #666; font-size: 15px;">
                        <i class="fas fa-chart-bar"></i> 
                        মোট: <span id="totalCount" style="font-weight: bold; color: var(--primary-color);">0</span>টি | 
                        লিঙ্ক সহ: <span id="linkCount" style="font-weight: bold; color: var(--success-color);">0</span>টি |
                        অ্যাপ: <span id="appStatus" style="font-weight: bold; color: var(--warning-color);">ওয়েব</span>
                    </div>
                    
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <select id="filterClass" onchange="filterData()">
                            <option value="">সব ক্লাস</option>
                            <option value="Class 6">Class 6</option>
                            <option value="Class 7">Class 7</option>
                            <option value="Class 8">Class 8</option>
                            <option value="Class 9">Class 9</option>
                            <option value="Class 10">Class 10</option>
                        </select>
                        
                        <select id="filterSubject" onchange="filterData()">
                            <option value="">সব বিষয়</option>
                            <option value="math">গণিত</option>
                            <option value="english">ইংরেজি</option>
                            <option value="science">বিজ্ঞান</option>
                            <option value="ict">ICT</option>
                            <option value="agriculture">কৃষি</option>
                        </select>
                        
                        <input type="text" id="searchInput" placeholder="খুঁজুন..." onkeyup="filterData()">
                    </div>
                </div>
                
                <div id="loading" class="loading-wave">
                    <div class="loading-bar"></div>
                    <div class="loading-bar"></div>
                    <div class="loading-bar"></div>
                    <div class="loading-bar"></div>
                </div>
                <div id="dataDisplay"></div>
            </div>
        </div>
        
        <!-- File Management Tab -->
        <div id="fileTab" class="tab-content">
            <div class="form-section">
                <h3><i class="fas fa-folder-open"></i> আপলোডকৃত ফাইলসমূহ</h3>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="totalFiles">0</div>
                        <div class="stat-label">মোট ফাইল</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="totalSize">0 MB</div>
                        <div class="stat-label">মোট সাইজ</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="pdfFiles">0</div>
                        <div class="stat-label">PDF ফাইল</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="imageFiles">0</div>
                        <div class="stat-label">ছবি</div>
                    </div>
                </div>
                
                <div class="filter-section">
                    <div style="color: #666; font-size: 15px;">
                        <i class="fas fa-hdd"></i> 
                        <span id="fileCount">0টি ফাইল</span> | 
                        <span id="storageUsed">0 MB ব্যবহৃত</span>
                    </div>
                    
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <select id="fileTypeFilter" onchange="filterFiles()">
                            <option value="">সব টাইপ</option>
                            <option value="pdf">PDF</option>
                            <option value="image">ছবি</option>
                            <option value="video">ভিডিও</option>
                            <option value="doc">ডকুমেন্ট</option>
                            <option value="zip">জিপ ফাইল</option>
                        </select>
                        
                        <input type="text" id="fileSearch" placeholder="ফাইল খুঁজুন..." onkeyup="filterFiles()">
                        
                        <button onclick="refreshFiles()" class="btn" style="width: auto; padding: 14px 25px;">
                            <i class="fas fa-sync-alt"></i> রিফ্রেশ
                        </button>
                    </div>
                </div>
                
                <div id="filesLoading" class="loading-wave">
                    <div class="loading-bar"></div>
                    <div class="loading-bar"></div>
                    <div class="loading-bar"></div>
                    <div class="loading-bar"></div>
                </div>
                <div id="filesDisplay"></div>
            </div>
        </div>
        
        <!-- File Upload Tab -->
        <div id="uploadTab" class="tab-content">
            <div class="form-section">
                <h3><i class="fas fa-cloud-upload-alt"></i> নতুন ফাইল আপলোড করুন</h3>
                
                <div class="two-column">
                    <div>
                        <div class="form-group">
                            <label><i class="fas fa-file-upload"></i> ফাইল নির্বাচন করুন:</label>
                            <div class="file-upload-container" id="dropArea" onclick="document.getElementById('fileInput').click()">
                                <span class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></span>
                                <p style="color: #666; margin: 10px 0; font-size: 18px; font-weight: 600;">এখানে ক্লিক করুন বা ফাইল ড্রপ করুন</p>
                                <p style="font-size: 15px; color: #888;">সাপোর্টেড: PDF, Image, Video, Word, Excel, PowerPoint, ZIP</p>
                                <p style="font-size: 13px; color: #aaa; margin-top: 10px;">ম্যাক্সিমাম সাইজ: 50MB</p>
                            </div>
                            <input type="file" id="fileInput" multiple style="display: none;" onchange="handleFileSelect(event)">
                        </div>
                        
                        <div class="upload-progress" id="uploadProgress">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        
                        <div id="filePreview"></div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-font"></i> ফাইলের নাম (বাংলা বা ইংরেজি):</label>
                            <input type="text" id="fileName" placeholder="যেমন: গণিত বই, English Grammar, Science Note">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-align-left"></i> বর্ণনা (ঐচ্ছিক):</label>
                            <textarea id="fileDescription" rows="3" placeholder="ফাইলের বিস্তারিত বর্ণনা লিখুন..."></textarea>
                        </div>
                    </div>
                    
                    <div>
                        <div class="form-group">
                            <label><i class="fas fa-graduation-cap"></i> ক্লাস নির্বাচন করুন:</label>
                            <select id="fileClass">
                                <option value="">-- ক্লাস সিলেক্ট করুন --</option>
                                <option value="Class 6">Class 6 - ষষ্ঠ শ্রেণী</option>
                                <option value="Class 7">Class 7 - সপ্তম শ্রেণী</option>
                                <option value="Class 8">Class 8 - অষ্টম শ্রেণী</option>
                                <option value="Class 9">Class 9 - নবম শ্রেণী</option>
                                <option value="Class 10">Class 10 - দশম শ্রেণী</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-book"></i> বিষয় নির্বাচন করুন:</label>
                            <select id="fileSubject">
                                <option value="">-- বিষয় সিলেক্ট করুন --</option>
                                <option value="math">গণিত (Mathematics)</option>
                                <option value="english">ইংরেজি (English)</option>
                                <option value="science">বিজ্ঞান (Science)</option>
                                <option value="ict">তথ্য ও যোগাযোগ প্রযুক্তি (ICT)</option>
                                <option value="agriculture">কৃষি শিক্ষা (Agriculture)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-file-alt"></i> ফাইল টাইপ:</label>
                            <select id="fileType">
                                <option value="pdf">PDF ডকুমেন্ট</option>
                                <option value="image">ছবি (Image)</option>
                                <option value="video">ভিডিও (Video)</option>
                                <option value="doc">ওয়ার্ড ডকুমেন্ট</option>
                                <option value="excel">এক্সেল ফাইল</option>
                                <option value="ppt">পাওয়ারপয়েন্ট</option>
                                <option value="zip">কম্প্রেসড ফাইল (ZIP/RAR)</option>
                                <option value="other">অন্যান্য</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-tags"></i> ট্যাগস (কমা দিয়ে আলাদা করুন):</label>
                            <input type="text" id="fileTags" placeholder="যেমন: বই, গাইড, নোট, প্রশ্ন, সমাধান">
                            <small style="color: #666; display: block; margin-top: 5px;">একাধিক ট্যাগ কমা (,) দিয়ে আলাদা করুন</small>
                        </div>
                        
                        <button onclick="uploadFile()" class="btn btn-success" id="uploadBtn">
                            <i class="fas fa-upload"></i> ফাইল আপলোড করুন
                        </button>
                    </div>
                </div>
                
                <!-- PWA Install Button -->
                <div class="install-button-container">
                    <h3><i class="fas fa-rocket"></i> অ্যাপ ইনস্টল করুন</h3>
                    <div class="install-features">
                        <div class="install-feature"><span><i class="fas fa-folder"></i></span> ফাইল ম্যানেজ</div>
                        <div class="install-feature"><span><i class="fas fa-bolt"></i></span> দ্রুত লোড</div>
                        <div class="install-feature"><span><i class="fas fa-wifi-slash"></i></span> অফলাইন</div>
                        <div class="install-feature"><span><i class="fas fa-bell"></i></span> নোটিফিকেশন</div>
                    </div>
                    <button id="installButton" class="btn btn-install" style="max-width: 300px; margin: 0 auto;">
                        <span style="font-size: 32px; display: block; margin-bottom: 10px;"><i class="fas fa-download"></i></span>
                        <strong>অ্যাপ ইনস্টল করুন</strong>
                        <br>
                        <small style="font-size: 13px; opacity: 0.9;">হোম স্ক্রিনে যুক্ত করুন</small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div id="installPrompt">
        <h4><i class="fas fa-mobile-alt"></i> শিক্ষা সহায়িকা অ্যাপ</h4>
        <p>এই অ্যাপটিকে ইনস্টল করুন এবং পূর্ণাঙ্গ মোবাইল অ্যাপের মতো ব্যবহার করুন:</p>
        <ul style="text-align: left; color: #555; margin: 20px 0; padding-left: 20px; font-size: 15px; line-height: 1.8;">
            <li><i class="fas fa-check-circle" style="color: var(--success-color);"></i> হোম স্ক্রিনে আইকন যুক্ত হবে</li>
            <li><i class="fas fa-check-circle" style="color: var(--success-color);"></i> ফুলস্ক্রিন মোডে চালু হবে</li>
            <li><i class="fas fa-check-circle" style="color: var(--success-color);"></i> অফলাইনেও ব্যবহার করতে পারবেন</li>
            <li><i class="fas fa-check-circle" style="color: var(--success-color);"></i> দ্রুত এক্সেস পাবেন</li>
            <li><i class="fas fa-check-circle" style="color: var(--success-color);"></i> নোটিফিকেশন পাবেন</li>
        </ul>
        <div class="prompt-buttons">
            <button onclick="installApp()" class="install-btn">
                <i class="fas fa-download"></i> ইনস্টল করুন
            </button>
            <button onclick="hideInstallPrompt()" class="later-btn">
                <i class="fas fa-clock"></i> পরে
            </button>
        </div>
    </div>

    <!-- iOS Install Instructions Modal -->
    <div id="iosInstallModal">
        <div class="ios-modal-content">
            <h3><i class="fab fa-apple"></i> iOS-এ অ্যাপ ইনস্টল করুন</h3>
            <p style="color: #666; margin-bottom: 25px; text-align: center;">
                iOS ডিভাইসে এই অ্যাপ ইনস্টল করতে নিচের স্টেপগুলো ফলো করুন:
            </p>
            
            <ol class="ios-steps">
                <li><strong>Safari ব্রাউজার</strong> ওপেন করুন (Chrome নয়)</li>
                <li>এই পেজে যান: <code style="background: #f1f1f1; padding: 5px 10px; border-radius: 5px; font-size: 14px;" id="currentUrl"></code></li>
                <li>নিচের শেয়ার আইকনে ট্যাপ করুন (বক্স থেকে বের হওয়া তীরের আইকন)</li>
                <li>লিস্ট থেকে <strong>"Add to Home Screen"</strong> সিলেক্ট করুন</li>
                <li>"Add" বাটনে ট্যাপ করুন</li>
                <li>হোম স্ক্রিনে অ্যাপ আইকন দেখা যাবে</li>
            </ol>
            
            <div style="background: #e8f4fd; padding: 20px; border-radius: var(--radius); margin: 25px 0;">
                <strong><i class="fas fa-lightbulb"></i> টিপ:</strong> Safari এর Settings → General → iPhone Storage → Website Data থেকে ওয়েবসাইট ডেটা ক্লিয়ার করতে পারেন যদি সমস্যা হয়।
            </div>
            
            <button onclick="closeIOSModal()" class="btn" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; width: 100%;">
                <i class="fas fa-check"></i> বুঝেছি, ধন্যবাদ
            </button>
        </div>
    </div>

    <!-- Android Install Instructions Modal -->
    <div id="androidInstallModal">
        <div class="android-modal-content">
            <h3><i class="fab fa-android"></i> Android-এ অ্যাপ ইনস্টল করুন</h3>
            <p style="color: #666; margin-bottom: 25px; text-align: center;">
                Android ডিভাইসে এই অ্যাপ ইনস্টল করতে নিচের স্টেপগুলো ফলো করুন:
            </p>
            
            <ol class="ios-steps">
                <li><strong>Chrome বা Brave ব্রাউজার</strong> ওপেন করুন</li>
                <li>এই পেজে যান: <code style="background: #f1f1f1; padding: 5px 10px; border-radius: 5px; font-size: 14px;" id="androidCurrentUrl"></code></li>
                <li>উপরের ডটস মেনুতে ট্যাপ করুন (⋮)</li>
                <li>লিস্ট থেকে <strong>"Install app"</strong> বা <strong>"Add to Home screen"</strong> সিলেক্ট করুন</li>
                <li>"Install" বা "Add" বাটনে ট্যাপ করুন</li>
                <li>হোম স্ক্রিনে অ্যাপ আইকন দেখা যাবে</li>
            </ol>
            
            <div style="background: #e8f4fd; padding: 20px; border-radius: var(--radius); margin: 25px 0;">
                <strong><i class="fas fa-lightbulb"></i> টিপ:</strong> যদি "Install app" অপশন না দেখেন, তবে "Add to Home screen" সিলেক্ট করুন।
            </div>
            
            <div class="prompt-buttons" style="margin-top: 25px;">
                <button onclick="closeAndroidModal()" class="btn" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; flex: 1;">
                    <i class="fas fa-check"></i> বুঝেছি
                </button>
                <button onclick="tryAutoInstall()" class="btn" style="background: linear-gradient(135deg, var(--success-color), var(--success-light)); color: white; flex: 1;">
                    <i class="fas fa-bolt"></i> স্বয়ংক্রিয় ইনস্টল
                </button>
            </div>
        </div>
    </div>

    <script>
        // ✅ Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB1vOW-DY6zIkXhPK5CRF3N8w-LzUKsvgg",
            authDomain: "education-app-8931d.firebaseapp.com",
            databaseURL: "https://education-app-8931d-default-rtdb.firebaseio.com",
            projectId: "education-app-8931d",
            storageBucket: "education-app-8931d.firebasestorage.app",
            messagingSenderId: "667995018685",
            appId: "1:667995018685:web:c8cdc1d432748cdc98eed4"
        };

        // ✅ Global Variables
        let db;
        let auth;
        let storage;
        let currentUser = null;
        let currentData = [];
        let currentFiles = [];
        let selectedFile = null;
        let deferredPrompt = null;
        let isAppInstalled = false;
        let isOnline = navigator.onLine;

        // ✅ Performance Optimizations
        const debounce = (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        };

        // ✅ Initialize Firebase with Error Handling
        function initializeFirebase() {
            try {
                // Show loading state
                document.getElementById('loading').style.display = 'flex';
                
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                auth = firebase.auth();
                storage = firebase.storage();
                
                console.log("✅ Firebase initialized successfully");
                showStatus("Firebase সংযোগ সফল", "success", 2000);
                setupAuth();
                
                // Hide loading after a short delay
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 500);
            } catch (error) {
                console.error("❌ Firebase initialization error:", error);
                showStatus("Firebase সংযোগ ব্যর্থ - ইন্টারনেট চেক করুন", "error", 5000);
                document.getElementById('loading').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>সংযোগ সমস্যা</h4>
                        <p>Firebase সংযোগ করতে সমস্যা হচ্ছে</p>
                        <button onclick="location.reload()" class="btn" style="max-width: 200px; margin: 20px auto;">
                            <i class="fas fa-redo"></i> রিলোড করুন
                        </button>
                    </div>
                `;
            }
        }

        // ✅ Authentication Setup
        function setupAuth() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    document.getElementById('userEmail').textContent = user.email;
                    document.getElementById('loginModal').style.display = 'none';
                    document.getElementById('adminContainer').style.display = 'block';
                    document.title = "শিক্ষা এডমিন - " + user.email;
                    
                    // Animate in
                    document.getElementById('adminContainer').style.animation = 'slideInUp 0.6s ease';
                    
                    // Show PWA status
                    checkAppInstalled();
                    
                    // Load data with animation
                    setTimeout(() => {
                        loadData();
                        loadFiles();
                    }, 300);
                    
                    // Check if we should show install prompt
                    setTimeout(() => {
                        if (!isAppInstalled && deferredPrompt) {
                            setTimeout(() => showInstallPrompt(), 1000);
                        }
                    }, 2000);
                    
                    showStatus("লগইন সফল! স্বাগতম " + user.email.split('@')[0], "success");
                    
                    // Update connection status
                    updateConnectionStatus();
                } else {
                    // User is signed out
                    currentUser = null;
                    document.getElementById('loginModal').style.display = 'flex';
                    document.getElementById('adminContainer').style.display = 'none';
                    document.title = "শিক্ষা সহায়িকা এডমিন";
                }
            });
        }

        // ✅ Login Function with Animation
        function loginAdmin() {
            const email = document.getElementById('adminEmail').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            const errorDiv = document.getElementById('loginError');
            const loginBtn = document.querySelector('.login-btn');
            
            if (!email || !password) {
                errorDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> ইমেইল এবং পাসওয়ার্ড দিন';
                errorDiv.style.display = 'block';
                shakeElement(errorDiv);
                return;
            }
            
            // Show loading on button
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> লগইন হচ্ছে...';
            loginBtn.disabled = true;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    errorDiv.style.display = 'none';
                    loginBtn.innerHTML = '<i class="fas fa-check"></i> সফল!';
                    setTimeout(() => {
                        loginBtn.innerHTML = originalText;
                        loginBtn.disabled = false;
                    }, 1000);
                })
                .catch((error) => {
                    let errorMessage = "লগইন ব্যর্থ";
                    switch(error.code) {
                        case 'auth/invalid-email': errorMessage = "ভুল ইমেইল ফরম্যাট"; break;
                        case 'auth/user-disabled': errorMessage = "অ্যাকাউন্ট নিষ্ক্রিয়"; break;
                        case 'auth/user-not-found': errorMessage = "এই ইমেইলে অ্যাকাউন্ট নেই"; break;
                        case 'auth/wrong-password': errorMessage = "ভুল পাসওয়ার্ড"; break;
                        case 'auth/too-many-requests': errorMessage = "অনেকবার চেষ্টা করেছেন, পরে আবার চেষ্টা করুন"; break;
                    }
                    errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${errorMessage}`;
                    errorDiv.style.display = 'block';
                    shakeElement(errorDiv);
                    
                    loginBtn.innerHTML = originalText;
                    loginBtn.disabled = false;
                });
        }

        // ✅ Shake Animation for Errors
        function shakeElement(element) {
            element.style.animation = 'none';
            setTimeout(() => {
                element.style.animation = 'shake 0.5s ease';
            }, 10);
        }

        // ✅ Add shake animation to CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);

        // ✅ Logout Function
        function logoutAdmin() {
            // Add animation
            document.getElementById('adminContainer').style.animation = 'fadeOut 0.5s ease';
            
            setTimeout(() => {
                auth.signOut()
                    .then(() => {
                        showStatus("লগআউট সফল", "info");
                    })
                    .catch((error) => {
                        console.error("Logout error:", error);
                    });
            }, 300);
        }

        // ✅ Tab Switching with Animation
        function switchTab(tabName) {
            // Get all tabs and buttons
            const tabs = document.querySelectorAll('.tab-content');
            const tabButtons = document.querySelectorAll('.tab');
            
            // Animate out current active tab
            const currentActive = document.querySelector('.tab-content.active');
            if (currentActive) {
                currentActive.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    currentActive.classList.remove('active');
                    currentActive.style.animation = '';
                }, 300);
            }
            
            // Remove active class from all tab buttons
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Add active class to clicked button with animation
            event.target.classList.add('active');
            event.target.style.transform = 'scale(0.95)';
            setTimeout(() => {
                event.target.style.transform = 'scale(1)';
            }, 150);
            
            // Show selected tab with animation
            setTimeout(() => {
                const selectedTab = document.getElementById(tabName);
                selectedTab.classList.add('active');
                selectedTab.style.animation = 'fadeIn 0.5s ease';
                
                // Load files if file tab is selected
                if (tabName === 'fileTab') {
                    loadFiles();
                }
            }, 300);
        }

        // ✅ Enhanced File Upload Functions
        let selectedFiles = [];
        
        function handleFileSelect(event) {
            selectedFiles = Array.from(event.target.files);
            if (selectedFiles.length > 0) {
                playSuccessSound();
            }
            displayFilePreview();
        }
        
        function displayFilePreview() {
            const previewDiv = document.getElementById('filePreview');
            previewDiv.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                return;
            }
            
            selectedFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-info';
                fileDiv.style.animation = 'slideInUp 0.4s ease';
                fileDiv.style.animationDelay = (index * 0.1) + 's';
                
                const fileName = file.name;
                const fileSize = formatFileSize(file.size);
                const fileType = getFileType(file.type);
                const fileIcon = getFileIcon(file.type);
                
                fileDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 28px; color: var(--primary-color);">
                                ${fileIcon}
                            </div>
                            <div>
                                <strong>${fileName}</strong>
                                <div class="file-size">
                                    <i class="fas fa-hdd"></i> ${fileSize} • 
                                    <i class="fas fa-file"></i> ${fileType}
                                </div>
                            </div>
                        </div>
                        <button onclick="removeFile(${index})" style="background: linear-gradient(135deg, var(--danger-color), #c0392b); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                previewDiv.appendChild(fileDiv);
            });
            
            if (selectedFiles.length > 0) {
                const firstName = selectedFiles[0].name.split('.')[0];
                document.getElementById('fileName').value = firstName;
            }
        }
        
        function getFileIcon(mimeType) {
            if (mimeType.includes('pdf')) return '<i class="fas fa-file-pdf"></i>';
            if (mimeType.includes('image')) return '<i class="fas fa-file-image"></i>';
            if (mimeType.includes('video')) return '<i class="fas fa-file-video"></i>';
            if (mimeType.includes('word') || mimeType.includes('document')) return '<i class="fas fa-file-word"></i>';
            if (mimeType.includes('excel') || mimeType.includes('spreadsheet')) return '<i class="fas fa-file-excel"></i>';
            if (mimeType.includes('powerpoint') || mimeType.includes('presentation')) return '<i class="fas fa-file-powerpoint"></i>';
            if (mimeType.includes('zip') || mimeType.includes('compressed')) return '<i class="fas fa-file-archive"></i>';
            return '<i class="fas fa-file"></i>';
        }
        
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            displayFilePreview();
            playRemoveSound();
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function getFileType(mimeType) {
            if (mimeType.includes('pdf')) return 'PDF';
            if (mimeType.includes('image')) return 'Image';
            if (mimeType.includes('video')) return 'Video';
            if (mimeType.includes('word') || mimeType.includes('document')) return 'Word';
            if (mimeType.includes('excel') || mimeType.includes('spreadsheet')) return 'Excel';
            if (mimeType.includes('powerpoint') || mimeType.includes('presentation')) return 'PowerPoint';
            if (mimeType.includes('zip') || mimeType.includes('compressed')) return 'ZIP';
            return 'Other';
        }

        // ✅ Upload File to Firebase Storage with Progress
        function uploadFile() {
            if (!selectedFiles.length) {
                showStatus("দয়া করে একটি ফাইল নির্বাচন করুন", "error");
                shakeElement(document.getElementById('dropArea'));
                return;
            }
            
            const fileName = document.getElementById('fileName').value.trim();
            const fileDescription = document.getElementById('fileDescription').value.trim();
            const fileClass = document.getElementById('fileClass').value;
            const fileSubject = document.getElementById('fileSubject').value;
            const fileType = document.getElementById('fileType').value;
            const fileTags = document.getElementById('fileTags').value;
            
            if (!fileName || !fileClass || !fileSubject) {
                showStatus("ফাইলের নাম, ক্লাস এবং বিষয় পূরণ করুন", "error");
                return;
            }
            
            const file = selectedFiles[0];
            const maxSize = 50 * 1024 * 1024; // 50MB
            
            if (file.size > maxSize) {
                showStatus("ফাইল সাইজ 50MB এর কম হতে হবে", "error");
                return;
            }
            
            // Generate unique file name
            const timestamp = Date.now();
            const fileExt = file.name.split('.').pop();
            const uniqueFileName = `${timestamp}_${Math.random().toString(36).substr(2, 9)}.${fileExt}`;
            
            // Create storage reference
            const storageRef = storage.ref(`files/${uniqueFileName}`);
            
            // Show progress bar
            const progressBar = document.getElementById('progressBar');
            const uploadProgress = document.getElementById('uploadProgress');
            uploadProgress.style.display = 'block';
            progressBar.style.width = '0%';
            
            // Disable upload button
            const uploadBtn = document.getElementById('uploadBtn');
            const originalBtnText = uploadBtn.innerHTML;
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> আপলোড হচ্ছে...';
            
            // Upload file
            const uploadTask = storageRef.put(file);
            
            uploadTask.on('state_changed',
                (snapshot) => {
                    // Progress monitoring
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressBar.style.width = progress + '%';
                },
                (error) => {
                    // Error handling
                    console.error("Upload error:", error);
                    showStatus("আপলোড ব্যর্থ: " + error.message, "error");
                    uploadProgress.style.display = 'none';
                    uploadBtn.disabled = false;
                    uploadBtn.innerHTML = originalBtnText;
                },
                () => {
                    // Upload completed
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        // Save file info to database
                        const fileData = {
                            originalName: file.name,
                            fileName: fileName,
                            description: fileDescription,
                            class: fileClass,
                            subject: fileSubject,
                            type: fileType,
                            tags: fileTags.split(',').map(tag => tag.trim()).filter(tag => tag),
                            size: file.size,
                            url: downloadURL,
                            storagePath: `files/${uniqueFileName}`,
                            uploadDate: new Date().toLocaleString('bn-BD'),
                            timestamp: timestamp,
                            uploadedBy: currentUser.email,
                            mimeType: file.type,
                            downloadCount: 0,
                            viewCount: 0
                        };
                        
                        db.ref('files').push(fileData)
                            .then(() => {
                                showStatus("ফাইল সফলভাবে আপলোড হয়েছে!", "success");
                                playSuccessSound();
                                
                                // Reset form with animation
                                document.getElementById('fileName').value = '';
                                document.getElementById('fileDescription').value = '';
                                document.getElementById('fileTags').value = '';
                                document.getElementById('filePreview').innerHTML = '';
                                selectedFiles = [];
                                document.getElementById('fileInput').value = '';
                                
                                // Hide progress bar
                                uploadProgress.style.display = 'none';
                                
                                // Enable upload button
                                uploadBtn.disabled = false;
                                uploadBtn.innerHTML = originalBtnText;
                                
                                // Load files list
                                loadFiles();
                            })
                            .catch((error) => {
                                showStatus("ডেটা সেভ ব্যর্থ: " + error.message, "error");
                                uploadProgress.style.display = 'none';
                                uploadBtn.disabled = false;
                                uploadBtn.innerHTML = originalBtnText;
                            });
                    });
                }
            );
        }
        
        // ✅ Load Files from Database with Animation
        function loadFiles() {
            if (!db) return;
            
            const filesDisplay = document.getElementById('filesDisplay');
            const filesLoading = document.getElementById('filesLoading');
            
            filesLoading.style.display = 'flex';
            filesDisplay.innerHTML = '';
            
            db.ref('files').orderByChild('timestamp').on('value', (snapshot) => {
                filesLoading.style.display = 'none';
                
                if (!snapshot.exists()) {
                    filesDisplay.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <h4>কোনো ফাইল নেই</h4>
                            <p>এখনও কোনো ফাইল আপলোড করা হয়নি</p>
                        </div>
                    `;
                    updateFileStats(0, 0, 0, 0, 0);
                    return;
                }
                
                currentFiles = [];
                let html = `
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>ফাইল নাম</th>
                                <th>ক্লাস</th>
                                <th>বিষয়</th>
                                <th>টাইপ</th>
                                <th>সাইজ</th>
                                <th>তারিখ</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody>`;
                
                let index = 1;
                let totalSize = 0;
                let pdfCount = 0;
                let imageCount = 0;
                let videoCount = 0;
                let docCount = 0;
                
                snapshot.forEach((child) => {
                    const val = child.val();
                    const key = child.key;
                    
                    currentFiles.push({key, ...val});
                    totalSize += val.size || 0;
                    
                    // Count by type
                    if (val.type === 'pdf') pdfCount++;
                    if (val.type === 'image') imageCount++;
                    if (val.type === 'video') videoCount++;
                    if (['doc', 'excel', 'ppt'].includes(val.type)) docCount++;
                    
                    const fileTypeClass = getFileTypeClass(val.type);
                    const fileTypeBadge = getFileTypeBadge(val.type);
                    const fileIcon = getFileIcon(val.mimeType || '');
                    
                    html += `
                        <tr style="animation: slideInRight 0.5s ease; animation-delay: ${(index * 0.05)}s;">
                            <td>${index}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="font-size: 20px; color: var(--primary-color);">
                                        ${fileIcon}
                                    </div>
                                    <div>
                                        <strong>${val.fileName}</strong>
                                        ${fileTypeBadge}
                                        <div style="font-size: 12px; color: #666;">${val.originalName}</div>
                                    </div>
                                </div>
                            </td>
                            <td>${val.class}</td>
                            <td>${getSubjectName(val.subject)}</td>
                            <td><span class="material-type ${fileTypeClass}">${val.type}</span></td>
                            <td>${formatFileSize(val.size)}</td>
                            <td>${val.uploadDate}</td>
                            <td>
                                <div class="action-buttons">
                                    <button onclick="viewFile('${key}')" class="view-btn" title="দেখুন"><i class="fas fa-eye"></i></button>
                                    <button onclick="downloadFile('${key}')" class="download-btn" title="ডাউনলোড"><i class="fas fa-download"></i></button>
                                    <button onclick="editFile('${key}')" class="edit-btn" title="এডিট"><i class="fas fa-edit"></i></button>
                                    <button onclick="deleteFile('${key}')" class="delete-btn" title="ডিলিট"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>`;
                    index++;
                });
                
                html += `</tbody></table>`;
                filesDisplay.innerHTML = html;
                
                // Update statistics
                updateFileStats(currentFiles.length, totalSize, pdfCount, imageCount, videoCount + docCount);
            });
        }
        
        function getFileTypeClass(type) {
            const types = {
                'pdf': 'pdf',
                'image': 'image',
                'video': 'video',
                'doc': 'book',
                'excel': 'book',
                'ppt': 'book',
                'zip': 'other',
                'other': 'other'
            };
            return types[type] || 'other';
        }
        
        function getFileTypeBadge(type) {
            const badges = {
                'pdf': '<span class="file-type-badge file-type-pdf">PDF</span>',
                'image': '<span class="file-type-badge file-type-image">IMG</span>',
                'video': '<span class="file-type-badge file-type-video">VID</span>',
                'doc': '<span class="file-type-badge file-type-doc">DOC</span>',
                'excel': '<span class="file-type-badge file-type-doc">XLS</span>',
                'ppt': '<span class="file-type-badge file-type-doc">PPT</span>',
                'zip': '<span class="file-type-badge file-type-zip">ZIP</span>',
                'other': '<span class="file-type-badge file-type-other">FILE</span>'
            };
            return badges[type] || badges['other'];
        }
        
        function updateFileStats(total, size, pdf, image, other) {
            document.getElementById('totalFiles').textContent = total;
            document.getElementById('totalSize').textContent = formatFileSize(size);
            document.getElementById('pdfFiles').textContent = pdf;
            document.getElementById('imageFiles').textContent = image;
            
            document.getElementById('fileCount').textContent = total + 'টি ফাইল';
            document.getElementById('storageUsed').textContent = formatFileSize(size) + ' ব্যবহৃত';
        }

        // ✅ View File with Enhanced UI
        function viewFile(key) {
            const file = currentFiles.find(f => f.key === key);
            if (!file) return;
            
            // Update view count
            db.ref('files/' + key + '/viewCount').transaction((count) => {
                return (count || 0) + 1;
            });
            
            const modal = document.getElementById('fileViewModal');
            const title = document.getElementById('fileViewTitle');
            const content = document.getElementById('fileViewContent');
            
            title.textContent = file.fileName;
            
            let contentHTML = `
                <div style="margin-bottom: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                            <div style="font-size: 13px; color: #7f8c8d; margin-bottom: 5px;">বর্ণনা</div>
                            <div>${file.description || 'কোনো বর্ণনা নেই'}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                            <div style="font-size: 13px; color: #7f8c8d; margin-bottom: 5px;">ক্লাস & বিষয়</div>
                            <div>${file.class} - ${getSubjectName(file.subject)}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                            <div style="font-size: 13px; color: #7f8c8d; margin-bottom: 5px;">টাইপ & সাইজ</div>
                            <div>${file.type} - ${formatFileSize(file.size)}</div>
                        </div>
                        <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                            <div style="font-size: 13px; color: #7f8c8d; margin-bottom: 5px;">আপলোড তারিখ</div>
                            <div>${file.uploadDate}</div>
                        </div>
                    </div>
                    
                    ${file.tags && file.tags.length ? `
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 8px;">ট্যাগস:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${file.tags.map(tag => `<span style="background: var(--light-bg); padding: 6px 12px; border-radius: 20px; font-size: 13px;">${tag}</span>`).join('')}
                        </div>
                    </div>` : ''}
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 25px; justify-content: center;">
                        <a href="${file.url}" target="_blank" class="btn" style="width: auto; padding: 12px 25px;">
                            <i class="fas fa-external-link-alt"></i> সরাসরি লিঙ্ক
                        </a>
                        <button onclick="downloadFile('${key}')" class="btn" style="width: auto; padding: 12px 25px; background: linear-gradient(135deg, var(--success-color), var(--success-light));">
                            <i class="fas fa-download"></i> ডাউনলোড করুন
                        </button>
                        <button onclick="copyToClipboard('${file.url}')" class="btn" style="width: auto; padding: 12px 25px; background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                            <i class="fas fa-copy"></i> লিঙ্ক কপি
                        </button>
                    </div>
                </div>
                <div style="margin-top: 30px; text-align: center;">`;
            
            if (file.type === 'pdf') {
                contentHTML += `
                    <iframe src="${file.url}" class="file-viewer pdf" frameborder="0"></iframe>
                    <p style="color: #666; margin-top: 15px; font-size: 14px;">
                        <i class="fas fa-spinner fa-spin"></i> PDF ভিউয়ার লোড হচ্ছে...
                    </p>
                `;
            } else if (file.type === 'image') {
                contentHTML += `
                    <img src="${file.url}" alt="${file.fileName}" class="file-viewer" onload="this.style.opacity='1'" style="opacity: 0; transition: opacity 0.5s;">
                `;
            } else if (file.type === 'video') {
                contentHTML += `
                    <video controls class="file-viewer" poster="https://i.ibb.co/XGNQ8V4/icon-180x180.png">
                        <source src="${file.url}" type="${file.mimeType || 'video/mp4'}">
                        আপনার ব্রাউজার ভিডিও সাপোর্ট করে না।
                    </video>
                `;
            } else {
                contentHTML += `
                    <div style="background: linear-gradient(135deg, var(--light-bg), white); padding: 60px 30px; border-radius: var(--radius-lg); text-align: center; border: 3px dashed var(--primary-color);">
                        <div style="font-size: 70px; color: var(--primary-color); margin-bottom: 20px;">
                            ${getFileIcon(file.mimeType || '')}
                        </div>
                        <h4 style="color: var(--secondary-color); margin-bottom: 15px;">ফাইল প্রিভিউ</h4>
                        <p style="color: #666; margin-bottom: 20px; max-width: 400px; margin-left: auto; margin-right: auto;">
                            এই ফাইলটির প্রিভিউ দেখানো সম্ভব নয়। ডাউনলোড করে দেখুন।
                        </p>
                        <p style="font-size: 14px; color: #888; background: white; padding: 8px 15px; border-radius: 20px; display: inline-block;">
                            ফাইল টাইপ: ${file.type.toUpperCase()}
                        </p>
                    </div>
                `;
            }
            
            contentHTML += `</div>`;
            content.innerHTML = contentHTML;
            modal.style.display = 'flex';
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showStatus("লিঙ্ক কপি করা হয়েছে!", "success");
            });
        }

        // ✅ Download File with Feedback
        function downloadFile(key) {
            const file = currentFiles.find(f => f.key === key);
            if (!file) return;
            
            // Update download count
            db.ref('files/' + key + '/downloadCount').transaction((count) => {
                return (count || 0) + 1;
            });
            
            // Show downloading status
            showStatus("ফাইল ডাউনলোড শুরু হচ্ছে...", "info");
            
            // Create download link
            const link = document.createElement('a');
            link.href = file.url;
            link.download = file.fileName + '.' + file.originalName.split('.').pop();
            link.style.display = 'none';
            document.body.appendChild(link);
            
            // Trigger download
            setTimeout(() => {
                link.click();
                document.body.removeChild(link);
                showStatus("ফাইল ডাউনলোড শুরু হয়েছে!", "success");
            }, 500);
        }

        // ✅ Edit File with Enhanced Form
        function editFile(key) {
            const file = currentFiles.find(f => f.key === key);
            if (!file) return;
            
            selectedFile = file;
            
            const modal = document.getElementById('fileEditModal');
            const content = document.getElementById('fileEditContent');
            
            let contentHTML = `
                <div class="form-group">
                    <label><i class="fas fa-font"></i> ফাইলের নাম:</label>
                    <input type="text" id="editFileName" value="${file.fileName}" placeholder="ফাইলের নাম">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-align-left"></i> বর্ণনা:</label>
                    <textarea id="editFileDescription" rows="3" placeholder="ফাইলের বিস্তারিত বর্ণনা">${file.description || ''}</textarea>
                </div>
                
                <div class="two-column" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label><i class="fas fa-graduation-cap"></i> ক্লাস:</label>
                        <select id="editFileClass">
                            <option value="Class 6" ${file.class === 'Class 6' ? 'selected' : ''}>Class 6 - ষষ্ঠ শ্রেণী</option>
                            <option value="Class 7" ${file.class === 'Class 7' ? 'selected' : ''}>Class 7 - সপ্তম শ্রেণী</option>
                            <option value="Class 8" ${file.class === 'Class 8' ? 'selected' : ''}>Class 8 - অষ্টম শ্রেণী</option>
                            <option value="Class 9" ${file.class === 'Class 9' ? 'selected' : ''}>Class 9 - নবম শ্রেণী</option>
                            <option value="Class 10" ${file.class === 'Class 10' ? 'selected' : ''}>Class 10 - দশম শ্রেণী</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-book"></i> বিষয়:</label>
                        <select id="editFileSubject">
                            <option value="math" ${file.subject === 'math' ? 'selected' : ''}>গণিত</option>
                            <option value="english" ${file.subject === 'english' ? 'selected' : ''}>ইংরেজি</option>
                            <option value="science" ${file.subject === 'science' ? 'selected' : ''}>বিজ্ঞান</option>
                            <option value="ict" ${file.subject === 'ict' ? 'selected' : ''}>ICT</option>
                            <option value="agriculture" ${file.subject === 'agriculture' ? 'selected' : ''}>কৃষি</option>
                            <option value="bangla" ${file.subject === 'bangla' ? 'selected' : ''}>বাংলা</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-tags"></i> ট্যাগস (কমা দিয়ে আলাদা করুন):</label>
                    <input type="text" id="editFileTags" value="${file.tags ? file.tags.join(', ') : ''}" placeholder="যেমন: বই, গাইড, নোট">
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 15px;">
                    <button onclick="updateFile('${key}')" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> আপডেট করুন
                    </button>
                    <button onclick="closeFileEditor()" class="btn" style="flex: 1; background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: white;">
                        <i class="fas fa-times"></i> বাতিল করুন
                    </button>
                </div>
            `;
            
            content.innerHTML = contentHTML;
            modal.style.display = 'flex';
        }

        // ✅ Update File Information
        function updateFile(key) {
            const fileName = document.getElementById('editFileName').value.trim();
            const fileDescription = document.getElementById('editFileDescription').value.trim();
            const fileClass = document.getElementById('editFileClass').value;
            const fileSubject = document.getElementById('editFileSubject').value;
            const fileTags = document.getElementById('editFileTags').value;
            
            if (!fileName || !fileClass || !fileSubject) {
                showStatus("ফাইলের নাম, ক্লাস এবং বিষয় পূরণ করুন", "error");
                return;
            }
            
            const updatedData = {
                fileName: fileName,
                description: fileDescription,
                class: fileClass,
                subject: fileSubject,
                tags: fileTags.split(',').map(tag => tag.trim()).filter(tag => tag),
                lastUpdated: new Date().toLocaleString('bn-BD')
            };
            
            db.ref('files/' + key).update(updatedData)
                .then(() => {
                    showStatus("ফাইল আপডেট সফল!", "success");
                    closeFileEditor();
                    loadFiles();
                })
                .catch((error) => {
                    showStatus("আপডেট ব্যর্থ: " + error.message, "error");
                });
        }

        // ✅ Delete File with Confirmation
        function deleteFile(key) {
            const file = currentFiles.find(f => f.key === key);
            if (!file) return;
            
            // Create custom confirmation modal
            const confirmHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 70px; color: var(--danger-color); margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3 style="color: var(--secondary-color); margin-bottom: 15px;">ফাইল ডিলিট করুন</h3>
                    <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                        আপনি কি নিশ্চিত <strong>"${file.fileName}"</strong> ফাইলটি ডিলিট করতে চান?<br>
                        এই কাজটি পরে পূর্বাবস্থায় ফেরানো যাবে না।
                    </p>
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button onclick="confirmDelete('${key}')" class="btn" style="flex: 1; background: linear-gradient(135deg, var(--danger-color), #c0392b);">
                            <i class="fas fa-trash"></i> ডিলিট করুন
                        </button>
                        <button onclick="closeConfirmModal()" class="btn" style="flex: 1; background: linear-gradient(135deg, #95a5a6, #7f8c8d);">
                            <i class="fas fa-times"></i> বাতিল করুন
                        </button>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'confirmModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    ${confirmHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }
        
        function confirmDelete(key) {
            const file = currentFiles.find(f => f.key === key);
            if (!file) return;
            
            // Delete from storage
            const storageRef = storage.ref(file.storagePath);
            storageRef.delete().then(() => {
                // Delete from database
                db.ref('files/' + key).remove()
                    .then(() => {
                        showStatus("ফাইল সফলভাবে ডিলিট হয়েছে", "success");
                        closeConfirmModal();
                        loadFiles();
                    })
                    .catch((error) => {
                        showStatus("ডিলিট ব্যর্থ: " + error.message, "error");
                    });
            }).catch((error) => {
                showStatus("স্টোরেজ থেকে ডিলিট ব্যর্থ: " + error.message, "error");
            });
        }
        
        function closeConfirmModal() {
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }

        // ✅ Filter Files with Debounce
        const filterFiles = debounce(function() {
            const typeFilter = document.getElementById('fileTypeFilter').value;
            const searchFilter = document.getElementById('fileSearch').value.toLowerCase();
            
            const filesDisplay = document.getElementById('filesDisplay');
            
            if (currentFiles.length === 0) {
                filesDisplay.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h4>কোনো ফাইল নেই</h4>
                        <p>ফিল্টারের সাথে মিলছে না</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>ফাইল নাম</th>
                            <th>ক্লাস</th>
                            <th>বিষয়</th>
                            <th>টাইপ</th>
                            <th>সাইজ</th>
                            <th>তারিখ</th>
                            <th>অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            let index = 1;
            let totalSize = 0;
            let pdfCount = 0;
            let imageCount = 0;
            
            currentFiles.forEach(file => {
                if (typeFilter && file.type !== typeFilter) return;
                if (searchFilter && !file.fileName.toLowerCase().includes(searchFilter) && 
                    !file.originalName.toLowerCase().includes(searchFilter) &&
                    !(file.description && file.description.toLowerCase().includes(searchFilter))) {
                    return;
                }
                
                totalSize += file.size || 0;
                if (file.type === 'pdf') pdfCount++;
                if (file.type === 'image') imageCount++;
                
                const fileTypeClass = getFileTypeClass(file.type);
                const fileTypeBadge = getFileTypeBadge(file.type);
                const fileIcon = getFileIcon(file.mimeType || '');
                
                html += `
                    <tr style="animation: fadeIn 0.5s ease;">
                        <td>${index}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 20px; color: var(--primary-color);">
                                    ${fileIcon}
                                </div>
                                <div>
                                    <strong>${file.fileName}</strong>
                                    ${fileTypeBadge}
                                    <div style="font-size: 12px; color: #666;">${file.originalName}</div>
                                </div>
                            </div>
                        </td>
                        <td>${file.class}</td>
                        <td>${getSubjectName(file.subject)}</td>
                        <td><span class="material-type ${fileTypeClass}">${file.type}</span></td>
                        <td>${formatFileSize(file.size)}</td>
                        <td>${file.uploadDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="viewFile('${file.key}')" class="view-btn"><i class="fas fa-eye"></i></button>
                                <button onclick="downloadFile('${file.key}')" class="download-btn"><i class="fas fa-download"></i></button>
                                <button onclick="editFile('${file.key}')" class="edit-btn"><i class="fas fa-edit"></i></button>
                                <button onclick="deleteFile('${file.key}')" class="delete-btn"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>`;
                index++;
            });
            
            html += `</tbody></table>`;
            
            if (index === 1) {
                filesDisplay.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h4>কোনো ফলাফল নেই</h4>
                        <p>আপনার সার্চের সাথে মিলছে না</p>
                    </div>
                `;
            } else {
                filesDisplay.innerHTML = html;
            }
            
            document.getElementById('fileCount').textContent = (index-1) + 'টি ফাইল';
            document.getElementById('storageUsed').textContent = formatFileSize(totalSize) + ' ব্যবহৃত';
        }, 300);

        // ✅ Refresh Files with Animation
        function refreshFiles() {
            const refreshBtn = event.target;
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            refreshBtn.disabled = true;
            
            loadFiles();
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
                showStatus("ফাইল লিস্ট রিফ্রেশ করা হয়েছে", "success");
            }, 1000);
        }

        // ✅ Close Modals with Animation
        function closeFileViewer() {
            const modal = document.getElementById('fileViewModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => {
                modal.style.display = 'none';
                modal.style.animation = '';
            }, 300);
        }
        
        function closeFileEditor() {
            const modal = document.getElementById('fileEditModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => {
                modal.style.display = 'none';
                modal.style.animation = '';
                selectedFile = null;
            }, 300);
        }

        // ✅ PWA Functions
        function checkAppInstalled() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            isAppInstalled = isStandalone || window.navigator.standalone;
            
            if (isAppInstalled) {
                document.querySelector('.app-installed-badge').style.display = 'flex';
                document.getElementById('appStatus').innerHTML = '<i class="fas fa-mobile-alt"></i> অ্যাপ';
            } else {
                document.querySelector('.app-installed-badge').style.display = 'none';
                document.getElementById('appStatus').innerHTML = '<i class="fas fa-globe"></i> ওয়েব';
            }
            
            return isAppInstalled;
        }
        
        // Before Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            document.getElementById('installButton').style.display = 'block';
            document.getElementById('installButtonMain').style.display = 'block';
        });
        
        // App Installed
        window.addEventListener('appinstalled', () => {
            isAppInstalled = true;
            checkAppInstalled();
            showStatus("অ্যাপ সফলভাবে ইনস্টল হয়েছে!", "success");
            deferredPrompt = null;
            document.getElementById('installPrompt').style.display = 'none';
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showStatus("অ্যাপ ইনস্টল করা হচ্ছে...", "success");
                    } else {
                        showStatus("ইনস্টল বাতিল করা হয়েছে", "warning");
                    }
                    deferredPrompt = null;
                    hideInstallPrompt();
                });
            } else {
                // Manual installation instructions
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    showIOSInstall();
                } else {
                    showAndroidInstall();
                }
            }
        }
        
        function showInstallPrompt() {
            const prompt = document.getElementById('installPrompt');
            prompt.style.display = 'block';
            prompt.style.animation = 'slideInRight 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        }
        
        function hideInstallPrompt() {
            const prompt = document.getElementById('installPrompt');
            prompt.style.animation = 'slideInRight 0.3s ease reverse';
            setTimeout(() => {
                prompt.style.display = 'none';
            }, 300);
        }
        
        function showIOSInstall() {
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('iosInstallModal').style.display = 'flex';
        }
        
        function showAndroidInstall() {
            document.getElementById('androidCurrentUrl').textContent = window.location.href;
            document.getElementById('androidInstallModal').style.display = 'flex';
        }
        
        function closeIOSModal() {
            document.getElementById('iosInstallModal').style.display = 'none';
        }
        
        function closeAndroidModal() {
            document.getElementById('androidInstallModal').style.display = 'none';
        }
        
        function tryAutoInstall() {
            if (deferredPrompt) {
                installApp();
            } else {
                showStatus("স্বয়ংক্রিয় ইনস্টল সম্ভব নয়, ম্যানুয়ালি ইনস্টল করুন", "warning");
            }
        }

        // ✅ Enhanced Status Function
        function showStatus(message, type, duration = 3000) {
            const statusDiv = document.getElementById('statusMessage');
            const icon = {
                'success': '<i class="fas fa-check-circle"></i>',
                'error': '<i class="fas fa-exclamation-circle"></i>',
                'warning': '<i class="fas fa-exclamation-triangle"></i>',
                'info': '<i class="fas fa-info-circle"></i>'
            }[type] || '';
            
            statusDiv.innerHTML = `${icon} ${message}`;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
            
            // Add fade out animation
            setTimeout(() => {
                statusDiv.style.opacity = '0';
                statusDiv.style.transform = 'translateX(100px)';
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                    statusDiv.style.opacity = '1';
                    statusDiv.style.transform = 'translateX(0)';
                }, 300);
            }, duration);
        }

        // ✅ Enhanced Add Data Function
        function addData() {
            if (!db || !currentUser) {
                showStatus("সংযোগ নেই বা লগইন করুন", "error");
                return;
            }

            const cls = document.getElementById('classSelect').value;
            const subject = document.getElementById('subjectSelect').value;
            const type = document.getElementById('typeSelect').value;
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const link = document.getElementById('link').value.trim();
            const linkType = document.getElementById('linkType').value;

            if (!cls || !subject || !type || !title) {
                showStatus("ক্লাস, বিষয়, টাইপ এবং শিরোনাম পূরণ করুন", "error");
                return;
            }

            let formattedLink = link;
            if (link && !link.startsWith('http')) {
                formattedLink = 'https://' + link;
            }

            const timestamp = Date.now();
            const newRef = db.ref('materials').push();
            
            const data = {
                class: cls,
                subject: subject,
                type: type,
                title: title,
                description: description,
                link: formattedLink || null,
                linkType: linkType,
                timestamp: timestamp,
                date: new Date().toLocaleString('bn-BD'),
                addedBy: currentUser.email
            };
            
            // Show loading on button
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> সেভ হচ্ছে...';
            submitBtn.disabled = true;
            
            newRef.set(data)
                .then(() => {
                    showStatus("কন্টেন্ট সংরক্ষণ করা হয়েছে!", "success");
                    
                    // Reset form with animation
                    const form = document.querySelector('.form-section');
                    form.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        form.style.transform = 'scale(1)';
                    }, 200);
                    
                    document.getElementById('title').value = "";
                    document.getElementById('description').value = "";
                    document.getElementById('link').value = "";
                    
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> সফল!';
                    setTimeout(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }, 1000);
                    
                    loadData();
                })
                .catch((error) => {
                    showStatus("সংরক্ষণ ব্যর্থ: " + error.message, "error");
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
        }
        
        // ✅ Enhanced Load Data Function
        function loadData() {
            if (!db) return;

            const display = document.getElementById('dataDisplay');
            const loading = document.getElementById('loading');
            
            loading.style.display = 'flex';
            display.innerHTML = '';
            
            db.ref('materials').on('value', (snapshot) => {
                loading.style.display = 'none';
                
                if (!snapshot.exists()) {
                    display.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <h4>কোনো কন্টেন্ট নেই</h4>
                            <p>প্রথম কন্টেন্ট যোগ করুন</p>
                        </div>
                    `;
                    updateCounts(0, 0);
                    return;
                }

                currentData = [];
                let html = `
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>শিরোনাম</th>
                                <th>ক্লাস</th>
                                <th>বিষয়</th>
                                <th>টাইপ</th>
                                <th>লিঙ্ক</th>
                                <th>তারিখ</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody>`;

                let index = 1;
                let linkCount = 0;
                
                snapshot.forEach((child) => {
                    const val = child.val();
                    const key = child.key;
                    
                    currentData.push({key, ...val});
                    
                    if (val.link) linkCount++;
                    
                    const subjectName = getSubjectName(val.subject || '');
                    const typeClass = getTypeClass(val.type || '');
                    const linkIcon = val.link ? 
                        `<i class="fas fa-link" style="color: var(--success-color);"></i>` : 
                        `<i class="fas fa-unlink" style="color: var(--danger-color);"></i>`;
                    
                    html += `
                        <tr style="animation: slideInUp 0.5s ease; animation-delay: ${(index * 0.05)}s;">
                            <td>${index}</td>
                            <td>
                                <strong>${val.title || 'N/A'}</strong>
                                ${val.description ? `<div style="font-size: 13px; color: #666; margin-top: 5px;">${val.description.substring(0, 50)}${val.description.length > 50 ? '...' : ''}</div>` : ''}
                            </td>
                            <td>${val.class || 'N/A'}</td>
                            <td>${subjectName}</td>
                            <td><span class="material-type ${typeClass}">${val.type || 'N/A'}</span></td>
                            <td>${linkIcon} ${val.link ? 'আছে' : 'নেই'}</td>
                            <td>${val.date || new Date(val.timestamp).toLocaleDateString('bn-BD')}</td>
                            <td>
                                <div class="action-buttons">
                                    <button onclick="viewData('${key}')" class="view-btn" title="দেখুন"><i class="fas fa-eye"></i></button>
                                    <button onclick="editData('${key}')" class="edit-btn" title="এডিট"><i class="fas fa-edit"></i></button>
                                    <button onclick="deleteData('${key}')" class="delete-btn" title="ডিলিট"><i class="fas fa-trash"></i></button>
                                </div>
                            </td>
                        </tr>`;
                    index++;
                });

                html += `</tbody></table>`;
                display.innerHTML = html;
                updateCounts(index-1, linkCount);
            });
        }
        
        function getSubjectName(subjectCode) {
            const subjects = {
                'math': 'গণিত',
                'english': 'ইংরেজি',
                'science': 'বিজ্ঞান',
                'ict': 'ICT',
                'agriculture': 'কৃষি'
            };
            return subjects[subjectCode] || subjectCode;
        }
        
        function getTypeClass(type) {
            const types = {
                'বই': 'book',
                'গাইড': 'guide',
                'নোট': 'note',
                'ভিডিও': 'video',
                'পিডিএফ': 'pdf',
                'প্রশ্ন': 'question',
                'ছবি': 'image',
                'MCQ': 'question'
            };
            return types[type] || 'book';
        }
        
        function updateCounts(total, links) {
            document.getElementById('totalCount').textContent = total;
            document.getElementById('linkCount').textContent = links;
        }
        
        function viewData(key) {
            const item = currentData.find(d => d.key === key);
            if (!item) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-file-alt"></i> ${item.title}</h3>
                        <button onclick="this.closest('.modal').remove()" class="close-modal">×</button>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
                            <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                                <div style="font-size: 13px; color: #7f8c8d;">ক্লাস</div>
                                <div style="font-weight: 600;">${item.class}</div>
                            </div>
                            <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                                <div style="font-size: 13px; color: #7f8c8d;">বিষয়</div>
                                <div style="font-weight: 600;">${getSubjectName(item.subject)}</div>
                            </div>
                            <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                                <div style="font-size: 13px; color: #7f8c8d;">টাইপ</div>
                                <div style="font-weight: 600;">${item.type}</div>
                            </div>
                            <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius);">
                                <div style="font-size: 13px; color: #7f8c8d;">তারিখ</div>
                                <div style="font-weight: 600;">${item.date}</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 8px;">বর্ণনা</div>
                            <div style="background: var(--light-bg); padding: 20px; border-radius: var(--radius); line-height: 1.6;">
                                ${item.description || 'কোনো বর্ণনা নেই'}
                            </div>
                        </div>
                        
                        ${item.link ? `
                        <div style="margin-bottom: 25px;">
                            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 8px;">লিঙ্ক</div>
                            <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius); display: flex; justify-content: space-between; align-items: center;">
                                <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 15px;">
                                    <i class="fas fa-link" style="color: var(--primary-color); margin-right: 8px;"></i>
                                    <a href="${item.link}" target="_blank" style="color: var(--primary-color); text-decoration: none;">${item.link}</a>
                                </div>
                                <button onclick="copyToClipboard('${item.link}')" style="background: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: var(--radius); cursor: pointer; flex-shrink: 0;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>` : ''}
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button onclick="this.closest('.modal').remove()" class="btn" style="width: auto; padding: 12px 30px;">
                                <i class="fas fa-times"></i> বন্ধ করুন
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }
        
        function editData(key) {
            const item = currentData.find(d => d.key === key);
            if (!item) return;
            
            document.getElementById('classSelect').value = item.class;
            document.getElementById('subjectSelect').value = item.subject;
            document.getElementById('typeSelect').value = item.type;
            document.getElementById('title').value = item.title;
            document.getElementById('description').value = item.description || '';
            document.getElementById('link').value = item.link || '';
            document.getElementById('linkType').value = item.linkType || 'other';
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-edit"></i> আপডেট করুন';
            submitBtn.onclick = () => updateData(key);
            submitBtn.style.background = 'linear-gradient(135deg, var(--warning-color), var(--warning-light))';
            
            // Scroll to form
            document.getElementById('contentTab').scrollIntoView({ behavior: 'smooth' });
            
            showStatus(`"${item.title}" এডিট মোডে`, "warning");
        }
        
        function updateData(key) {
            if (!db) return;

            const cls = document.getElementById('classSelect').value;
            const subject = document.getElementById('subjectSelect').value;
            const type = document.getElementById('typeSelect').value;
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const link = document.getElementById('link').value.trim();
            const linkType = document.getElementById('linkType').value;

            if (!cls || !subject || !type || !title) {
                showStatus("সব ফিল্ড পূরণ করুন", "error");
                return;
            }

            let formattedLink = link;
            if (link && !link.startsWith('http')) {
                formattedLink = 'https://' + link;
            }

            const updatedData = {
                class: cls,
                subject: subject,
                type: type,
                title: title,
                description: description,
                link: formattedLink || null,
                linkType: linkType,
                lastUpdated: new Date().toLocaleString('bn-BD')
            };
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            submitBtn.disabled = true;
            
            db.ref('materials/' + key).update(updatedData)
                .then(() => {
                    showStatus("আপডেট সফল!", "success");
                    
                    // Reset form
                    document.getElementById('title').value = "";
                    document.getElementById('description').value = "";
                    document.getElementById('link').value = "";
                    
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> ডেটা সেভ করুন';
                    submitBtn.onclick = addData;
                    submitBtn.disabled = false;
                    submitBtn.style.background = '';
                    
                    loadData();
                })
                .catch((error) => {
                    showStatus("আপডেট ব্যর্থ", "error");
                    submitBtn.innerHTML = '<i class="fas fa-edit"></i> আপডেট করুন';
                    submitBtn.disabled = false;
                });
        }
        
        function deleteData(key) {
            const item = currentData.find(d => d.key === key);
            if (!item) return;
            
            const confirmHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 70px; color: var(--danger-color); margin-bottom: 20px;">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <h3 style="color: var(--secondary-color); margin-bottom: 15px;">কন্টেন্ট ডিলিট করুন</h3>
                    <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                        আপনি কি নিশ্চিত <strong>"${item.title}"</strong> কন্টেন্টটি ডিলিট করতে চান?
                    </p>
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button onclick="confirmDeleteData('${key}')" class="btn" style="flex: 1; background: linear-gradient(135deg, var(--danger-color), #c0392b);">
                            <i class="fas fa-trash"></i> ডিলিট করুন
                        </button>
                        <button onclick="closeConfirmDataModal()" class="btn" style="flex: 1; background: linear-gradient(135deg, #95a5a6, #7f8c8d);">
                            <i class="fas fa-times"></i> বাতিল করুন
                        </button>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'confirmDataModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    ${confirmHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }
        
        function confirmDeleteData(key) {
            if (!db) return;
            
            db.ref('materials/' + key).remove()
                .then(() => {
                    showStatus("ডিলিট সফল", "success");
                    closeConfirmDataModal();
                    loadData();
                })
                .catch((error) => {
                    showStatus("ডিলিট ব্যর্থ", "error");
                });
        }
        
        function closeConfirmDataModal() {
            const modal = document.getElementById('confirmDataModal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }
        
        // ✅ Enhanced Filter Data with Debounce
        const filterData = debounce(function() {
            const classFilter = document.getElementById('filterClass').value;
            const subjectFilter = document.getElementById('filterSubject').value;
            const searchFilter = document.getElementById('searchInput').value.toLowerCase();
            
            const display = document.getElementById('dataDisplay');
            
            if (currentData.length === 0) {
                display.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h4>কোনো কন্টেন্ট নেই</h4>
                        <p>ফিল্টারের সাথে মিলছে না</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>শিরোনাম</th>
                            <th>ক্লাস</th>
                            <th>বিষয়</th>
                            <th>টাইপ</th>
                            <th>লিঙ্ক</th>
                            <th>তারিখ</th>
                            <th>অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            let index = 1;
            let linkCount = 0;
            
            currentData.forEach(item => {
                if (classFilter && item.class !== classFilter) return;
                if (subjectFilter && item.subject !== subjectFilter) return;
                if (searchFilter && !item.title.toLowerCase().includes(searchFilter) && 
                    !(item.description && item.description.toLowerCase().includes(searchFilter))) {
                    return;
                }
                
                if (item.link) linkCount++;
                
                const subjectName = getSubjectName(item.subject);
                const typeClass = getTypeClass(item.type);
                const linkIcon = item.link ? 
                    `<i class="fas fa-link" style="color: var(--success-color);"></i>` : 
                    `<i class="fas fa-unlink" style="color: var(--danger-color);"></i>`;
                
                html += `
                    <tr style="animation: fadeIn 0.5s ease;">
                        <td>${index}</td>
                        <td>
                            <strong>${item.title}</strong>
                            ${item.description ? `<div style="font-size: 13px; color: #666; margin-top: 5px;">${item.description.substring(0, 50)}${item.description.length > 50 ? '...' : ''}</div>` : ''}
                        </td>
                        <td>${item.class}</td>
                        <td>${subjectName}</td>
                        <td><span class="material-type ${typeClass}">${item.type}</span></td>
                        <td>${linkIcon} ${item.link ? 'আছে' : 'নেই'}</td>
                        <td>${item.date || new Date(item.timestamp).toLocaleDateString('bn-BD')}</td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="viewData('${item.key}')" class="view-btn"><i class="fas fa-eye"></i></button>
                                <button onclick="editData('${item.key}')" class="edit-btn"><i class="fas fa-edit"></i></button>
                                <button onclick="deleteData('${item.key}')" class="delete-btn"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>`;
                index++;
            });
            
            html += `</tbody></table>`;
            
            if (index === 1) {
                display.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h4>কোনো ফলাফল নেই</h4>
                        <p>আপনার সার্চের সাথে মিলছে না</p>
                    </div>
                `;
            } else {
                display.innerHTML = html;
            }
            
            updateCounts(index-1, linkCount);
        }, 300);

        // ✅ Update Connection Status
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            
            if (navigator.onLine) {
                isOnline = true;
                statusIcon.className = 'fas fa-wifi';
                statusText.textContent = 'অনলাইন';
                statusElement.classList.remove('status-offline');
                statusElement.style.animation = 'pulse 3s infinite';
            } else {
                isOnline = false;
                statusIcon.className = 'fas fa-wifi-slash';
                statusText.textContent = 'অফলাইন';
                statusElement.classList.add('status-offline');
                statusElement.style.animation = 'none';
                showStatus("ইন্টারনেট সংযোগ নেই", "warning");
            }
        }
        
        // Network status listeners
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);

        // ✅ Sound Effects (Optional)
        function playSuccessSound() {
            // Simple beep sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Sound not supported, silent failure
            }
        }
        
        function playRemoveSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 400;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Sound not supported
            }
        }

        // ✅ Initialize on Load
        document.addEventListener('DOMContentLoaded', function() {
            // Add fadeOut animation to CSS
            const fadeOutStyle = document.createElement('style');
            fadeOutStyle.textContent = `
                @keyframes fadeOut {
                    from { opacity: 1; transform: scale(1); }
                    to { opacity: 0; transform: scale(0.95); }
                }
            `;
            document.head.appendChild(fadeOutStyle);
            
            // Initialize Firebase
            initializeFirebase();
            
            // Drag and drop for file upload
            const dropArea = document.getElementById('dropArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('dragover');
            }
            
            function unhighlight() {
                dropArea.classList.remove('dragover');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                selectedFiles = Array.from(files);
                if (selectedFiles.length > 0) {
                    playSuccessSound();
                }
                displayFilePreview();
            }
            
            // Check app installed
            checkAppInstalled();
            
            // Set up install button listeners
            document.getElementById('installButton').addEventListener('click', function() {
                if (deferredPrompt) {
                    installApp();
                } else {
                    if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                        showIOSInstall();
                    } else {
                        showAndroidInstall();
                    }
                }
            });
            
            document.getElementById('installButtonMain').addEventListener('click', function() {
                if (deferredPrompt) {
                    installApp();
                } else {
                    if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                        showIOSInstall();
                    } else {
                        showAndroidInstall();
                    }
                }
            });
            
            // Initial network status check
            updateConnectionStatus();
            
            // Show welcome message
            setTimeout(() => {
                if (!currentUser) {
                    showStatus("শিক্ষা সহায়িকা এডমিনে স্বাগতম", "info", 4000);
                }
            }, 1000);
        });
    </script>
</body>
</html>
